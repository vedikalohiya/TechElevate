<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Soft Skills Training Hub</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f9ff;
      color: #0A2647;
    }
    header {
      background: #0A2647;
      color: white;
      padding: 20px;
      text-align: center;
    }
    section {
      padding: 30px 20px;
      max-width: 1000px;
      margin: auto;
    }
    h2 {
      border-bottom: 2px solid #0A2647;
      padding-bottom: 5px;
      margin-bottom: 20px;
    }
    iframe {
      width: 100%;
      height: 315px;
      margin-bottom: 15px;
      border: none;
      border-radius: 8px;
    }
    .quiz, .tracker {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-top: 20px;
    }
    .question {
      margin-bottom: 15px;
    }
    button {
      background: #0A2647;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background: #06386f;
    }
    .result {
      margin-top: 10px;
      font-weight: bold;
      color: green;
    }
    label {
      display: block;
      margin: 5px 0;
    }
    input[type="checkbox"] {
      margin-right: 10px;
    }
    .download-link {
      margin-top: 20px;
      display: block;
    }
    @media(max-width: 600px) {
      iframe { height: 200px; }
    }
  </style>
</head>
<body>

<header>
  <h1>Soft Skills Training Hub</h1>
  <p>Your one-stop solution for mastering soft skills</p>
</header>

<section>
  <h2>üì∫ Learn with Videos</h2>
  <iframe src="https://www.youtube.com/embed/7KXGZAEWzn0" title="Communication Skills Tips"></iframe>
  <iframe src="https://www.youtube.com/embed/j7x3h3H1GZs" title="How to Speak Effectively"></iframe>
</section>

<section class="quiz">
  <h2>üß† Quick Soft Skills Quiz</h2>
  <div class="question">
    <p>1. What is the key to good communication?</p>
    <label><input type="radio" name="q1" value="a"> Speaking fast</label>
    <label><input type="radio" name="q1" value="b"> Listening actively</label>
    <label><input type="radio" name="q1" value="c"> Arguing logically</label>
  </div>
  <div class="question">
    <p>2. What improves teamwork the most?</p>
    <label><input type="radio" name="q2" value="a"> Criticizing others</label>
    <label><input type="radio" name="q2" value="b"> Collaboration</label>
    <label><input type="radio" name="q2" value="c"> Competition</label>
  </div>
  <button onclick="checkQuiz()">Submit Quiz</button>
  <div id="quizResult" class="result"></div>
</section>

<section class="tracker">
  <h2>üìÖ Daily Soft Skills Habit Tracker</h2>
  <div id="habit-list">
    <label><input type="checkbox" data-key="habit_speak"> Practice 15 mins English speaking</label>
    <label><input type="checkbox" data-key="habit_video"> Watch 1 soft skills video</label>
    <label><input type="checkbox" data-key="habit_reflect"> Reflect on one communication mistake</label>
    <label><input type="checkbox" data-key="habit_body"> Practice positive body language</label>
    <label><input type="checkbox" data-key="habit_feedback"> Give positive feedback to a peer</label>
  </div>
  <div style="margin-top:10px;">
    <button onclick="clearHabits()">Clear Today</button>
    <button onclick="saveSoftskillsServer()" style="margin-left:10px;">Save to account</button>
    <button onclick="exportHabits()" style="margin-left:10px;">Export Checklist</button>
  </div>
</section>

<section class="tracker">
  <h2>üì• Download Checklist</h2>
  <p>Click below to get your 1-week goal planner and self-rating tracker.</p>
  <a href="soft-skills-checklist.pdf" download class="download-link">
    <button>Download PDF</button>
  </a>
</section>

<section>
  <h2>üóÇÔ∏è Two-week Study Plan (Suggested)</h2>
  <ol>
    <li>Week 1 ‚Äî Foundations: Daily 15 min speaking + 1 video + 10 min reflection.</li>
    <li>Week 2 ‚Äî Practice: Role-play interviews, give feedback to peers, record one mock talk.</li>
    <li>Daily: Keep a 3-line journal ‚Äî one thing I learned, one improvement, one action.</li>
  </ol>
</section>

<section>
  <h2>üí¨ Behavioral Interview Practice</h2>
  <p>Practice answers using STAR (Situation, Task, Action, Result). Pick a question and record a 2-minute answer.</p>
  <ul>
    <li>Tell me about a time you had a conflict at work/study and how you resolved it.</li>
    <li>Describe a situation where you showed leadership.</li>
    <li>Give an example of when you had to take initiative.</li>
  </ul>
  <div class="quiz">
    <h3>Try a quick role-play:</h3>
    <p><strong>Interviewer:</strong> "Describe a time when you missed a deadline."</p>
    <textarea id="roleAnswer" rows="4" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ddd;"></textarea>
    <button onclick="saveRole()">Save Answer</button>
    <button onclick="saveSoftskillsServer()" style="margin-left:10px;">Save to account</button>
    <div id="roleSaved" class="result" style="color:#064C6C; display:none;">Saved locally.</div>
  </div>
</section>

<section>
  <h2>üîó Further Resources</h2>
  <ul>
    <li><a href="https://www.mindtools.com/pages/main/newMN_TCS.htm" target="_blank">MindTools ‚Äî Communication & Teamwork</a></li>
    <li><a href="https://www.hbr.org/topic/communication" target="_blank">Harvard Business Review ‚Äî Communication</a></li>
    <li><a href="https://www.toastmasters.org/" target="_blank">Toastmasters (Public speaking practice)</a></li>
  </ul>
</section>

<script>
  function checkQuiz() {
    const q1 = document.querySelector('input[name="q1"]:checked')?.value;
    const q2 = document.querySelector('input[name="q2"]:checked')?.value;
    let score = 0;
    if (q1 === 'b') score++;
    if (q2 === 'b') score++;
    const resultText = `You scored ${score}/2 üéØ`;
    document.getElementById("quizResult").innerText = resultText;
  }

  // Persist habit tracker state in localStorage
  const habitInputs = document.querySelectorAll('#habit-list input[type="checkbox"]');
  habitInputs.forEach(cb => {
    const key = cb.dataset.key;
    const saved = localStorage.getItem(key);
    if (saved === 'true') cb.checked = true;
    cb.addEventListener('change', () => {
      localStorage.setItem(key, cb.checked);
    });
  });

  // Load saved softskills data from server if available
  async function loadSoftskills(){
    try{
      const res = await fetch('/api/softskills');
      if(!res.ok){
        // if email not provided, server will return 400. Ignore silently.
        return;
      }
      const j = await res.json();
      const data = j.data || {};
      if(data.habits){
        habitInputs.forEach(cb => {
          const key = cb.dataset.key;
          if(data.habits.hasOwnProperty(key)) cb.checked = !!data.habits[key];
        });
      }
      if(data.role_play_answer){
        document.getElementById('roleAnswer').value = data.role_play_answer;
      }
    }catch(err){
      console.debug('loadSoftskills error', err);
    }
  }

  function clearHabits(){
    habitInputs.forEach(cb => {
      cb.checked = false;
      localStorage.removeItem(cb.dataset.key);
    });
  }

  function exportHabits(){
    const data = {};
    habitInputs.forEach(cb => data[cb.dataset.key] = cb.checked);
    const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'softskills-habits.json';
    document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }

  // Role-play save (simple localStorage)
  function saveRole(){
    const val = document.getElementById('roleAnswer').value.trim();
    if(!val) return alert('Please type your answer before saving.');
    localStorage.setItem('role_play_answer', val);
    const el = document.getElementById('roleSaved');
    el.style.display = 'block';
    setTimeout(()=> el.style.display = 'none', 2000);
    // try to save to server (will require login or email)
    saveSoftskillsServer();
  }

  // collect current habit state and role answer and POST to server
  async function saveSoftskillsServer(){
    const habits = {};
    habitInputs.forEach(cb => habits[cb.dataset.key] = cb.checked);
    const role = document.getElementById('roleAnswer').value.trim() || localStorage.getItem('role_play_answer') || '';
    const payload = {habits: habits, role_play_answer: role};
    try{
      const res = await fetch('/api/softskills', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const j = await res.json();
      if(res.ok){
        alert(j.message || 'Saved to account.');
      } else if (j && j.message && j.message.includes('Email')){
        // ask user for email to save when not logged in
        const email = prompt('Enter your email to save data to your account:');
        if(email){
          payload.email = email;
          const r2 = await fetch('/api/softskills', {
            method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload)
          });
          const j2 = await r2.json();
          if(r2.ok) alert(j2.message || 'Saved.'); else alert(j2.message || 'Save failed.');
        }
      } else {
        alert(j.message || 'Save failed.');
      }
    }catch(err){
      console.error('saveSoftskillsServer error', err);
      alert('Unable to save to server.');
    }
  }

  // load on page ready
  window.addEventListener('DOMContentLoaded', loadSoftskills);
</script>

</body>
</html>
